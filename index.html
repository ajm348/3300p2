<html>
<head>	
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<style>
	.axis path,
	.axis line {
	    fill: none;
	    stroke: black;
	    shape-rendering: crispEdges;
	}
	.axis text {
	    font-family: sans-serif;
	    font-size: 7px;
	}
	svg {
		border: 1px solid blue;
	}
	.tooltip {
	  position: absolute;
	  width: 200px;
	  height: 28px;
	  pointer-events: none;
	}

</style>

</head>

<body>
<div id="lineGraph">

<form>
  <input type="radio" name="threePoints" value="TPP" onclick="updateData(value)" checked> 3P%<br>
  <input type="radio" name="threePoints" value="TPA" onclick="updateData(value)"> 3PA<br>
</form>
<label class="switch">
  <input id="leagueAvg" type="checkbox" onclick="addLeagueAverage()">League Average
  <div class="slider"></div>
</label>
</div>


<script type="text/javascript">

	var isPercent = true;
	var loadedAvgs = false;
	var lgHeight = 800;
	var lgWidth = 1000;
	var axesOffset = 100;
	var champYear = [];
	var champTeam = [];
	var threeAttempts = [];
	var threePercent = [];
	var avgThreeAttempts =[];
	var avgThreePercent = [];



	var svg = d3.select("#lineGraph").append("svg")
	.attr("width", lgWidth)
	.attr("height", lgHeight);

	var xScale = d3.scale.linear()
				.domain([1980,2015])
				.range([0,lgWidth - axesOffset]);

	// var yScale3pta = d3.scale.linear()
	// 				.domain()
	// 				.range([lgHeight,0]);

	var xAxis = d3.svg.axis()
	.scale(xScale)
	.ticks(30)
	.orient("bottom");

	svg.append("g")
	.attr("class", "x axis")
	.attr("transform", "translate("+(axesOffset/2)+", " + (lgHeight - axesOffset/2)+ ")")
	.call(xAxis);


	// add the tooltip area to the webpage
	var tooltip = d3.select("body").append("div")
	    .attr("class", "tooltip")
	    .style("opacity", 0);

	d3.csv("p2sampledata.csv", function(error, data){
		
		data.forEach(function(d){
			if(d.Year >= 1980){
				champYear.push(d.Year);
				champTeam.push(d.Team);
				threeAttempts.push(d.TPA);
				threePercent.push(d.TPP);
			}

		})

		var y3PercentScale = d3.scale.linear()
			.domain([0, Math.max.apply(Math, threePercent)])
			.range([lgHeight - axesOffset, 0]);
		var y3AttemptScale = d3.scale.linear()
			.domain([Math.min.apply(Math, threeAttempts), Math.max.apply(Math, threeAttempts)])
			.range([lgHeight -axesOffset, 0]);

		var y3PercentAxis = d3.svg.axis()
		.scale(y3PercentScale)
		.ticks(50)
		.orient("left");

		var y3AttemptAxis = d3.svg.axis()
		.scale(y3AttemptAxis)
		.ticks(50)
		.orient("left");

		svg.append("g")
		.attr("class", "y axis")
		.attr("transform", "translate("+axesOffset/2+", 50)")
		.call(y3PercentAxis);

		for (i = 0; i<champYear.length; i++){
			var image = "assets/img/" + champTeam[i] +  ".png";
			svg.append("svg:image")
			.attr('x', xScale(champYear[i]) + axesOffset*2/5)
			.attr('y', y3PercentScale(threePercent[i]) + axesOffset*2/5)
			.attr("height", 25)
			.attr('width', 25)
			.attr('class', 'locale')
			.attr("xlink:href", image);


		}




	});


	function addLeagueAverage(){
		//If box is checked then add the league averages
		if(document.getElementById("leagueAvg").checked){


			d3.csv("average_3p_data.csv", function(error,data){
			if(!loadedAvgs){
				loadedAvgs = true;
				data.forEach(function(d){
					avgThreeAttempts.push(d.avgTPA);
					avgThreePercent.push(d.avgTPP);

				});
			}

				//console.log(avgThreePercent);
				var y3PercentScale = d3.scale.linear()
					.domain([0, Math.max.apply(Math, threePercent)])
					.range([lgHeight - axesOffset, 0]);
				var y3AttemptScale = d3.scale.linear()
					.domain([0, Math.max.apply(Math, threeAttempts)])
					.range([lgHeight -axesOffset, 0]);

				var y3PercentAxis = d3.svg.axis()
				.scale(y3PercentScale)
				.ticks(50)
				.orient("left");

				var y3AttemptAxis = d3.svg.axis()
				.scale(y3AttemptAxis)
				.ticks(50)
				.orient("left");
//console.log(champYear);


		if (isPercent){

			for (i = 0; i<champYear.length; i++){
				
				svg.append("circle")
				.attr('cx', xScale(champYear[i]) + axesOffset*1/2)
				.attr('cy', y3PercentScale(avgThreePercent[i]) + axesOffset*1/2)
				.attr("r", 5)
				.attr('class', 'avgs')
				.style("fill", "black")
				.on("mouseover", function(d){
					
				})


			}

		}

		
		//else do #3pa
		else{
			for (i = 0; i<champYear.length; i++){
				
				svg.append("circle")
				.attr('cx', xScale(champYear[i]) + axesOffset*1/2)
				.attr('cy', y3AttemptScale(avgThreeAttempts[i]) + axesOffset*1/2)
				.attr("r", 5)
				.attr('class', 'avgs')
				.style("fill", "black")


			}


		}



		});


	}
	//Box is unchecked
	else{

		svg.selectAll(".avgs").remove();

	}

}


	function updateData(category) {
		if(category == 'TPA'){
			isPercent = false;
		}
		else{
			isPercent = true;
		}

		//svg.selectAll(".locale").remove();
		d3.csv("p2sampledata.csv", function(error, data){

		var y3PercentScale = d3.scale.linear()
			.domain([Math.min.apply(Math, threePercent), Math.max.apply(Math, threePercent)])
			.range([lgHeight - axesOffset, 0]);
		var y3AttemptScale = d3.scale.linear()
			.domain([0, Math.max.apply(Math, threeAttempts)])
			.range([lgHeight -axesOffset, 0]);

		var y3PercentAxis = d3.svg.axis()
		.scale(y3PercentScale)
		.ticks(50)
		.orient("left");

		var y3AttemptAxis = d3.svg.axis()
		.scale(y3AttemptScale)
		.ticks(50)
		.orient("left");

		var threeData;
		var yScale;

		if(isPercent){
			svg.select(".y.axis").transition().duration(1500).call(y3PercentAxis);
			threeData = threePercent;
			yScale = y3PercentScale;
		}
		else{
			svg.select(".y.axis").transition().duration(1500).call(y3AttemptAxis);
			threeData = threeAttempts;
			yScale = y3AttemptScale;
		}


		d3.selectAll(".locale")[0].forEach(function(point,i) {
			d3.select(point).transition().duration(1500)
			.attr('y', yScale(threeData[i]) + axesOffset*2/5)
			});
		// for (i = 0; i<champYear.length; i++){
		// 	var image = "assets/img/" + champTeam[i] +  ".png";
		// 	svg.append("svg:image")
		// 	.attr('x', xScale(champYear[i]) + axesOffset*2/5)
		// 	.attr('y', yScale(threeData[i]) + axesOffset*2/5)
		// 	.attr("height", 25)
		// 	.attr('width', 25)
		// 	.attr('class', 'locale')
		// 	.attr("xlink:href", image);
		// }



		});



		if(document.getElementById("leagueAvg").checked){
			svg.selectAll(".avgs").remove();
			addLeagueAverage();
		}
	}

</script>




</body>

</html>